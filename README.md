# shared_mailbox_Y360

## Инструкция (README.md)


Python-скрипт для автоматического создания **общего почтового ящика** в Яндекс 360 и назначения прав доступа сотрудникам по файлу `actors.csv`.

---

## Возможности

- Создание **общего ящика** (`PUT /mailboxes/shared`) с заданными `email`, `name`, `description`.
- Парсинг файла `actors.csv` и назначение ролей.
- Поддержка параметра уведомлений (`notify = all|delegates|none`) как глобально (через `.env`), так и построчно для каждого сотрудника.
- Автоматическая проверка ролей:
  - `shared_mailbox_owner` включает все остальные.
  - Если нет `sender/owner` → автоматически добавляется `shared_mailbox_sender`.

---

## Установка

1. Клонируйте репозиторий:
   ```bash
   git clone https://github.com/<your-org>/<your-repo>.git
   cd <your-repo>
  

2. Установите зависимости:

   ```bash
   pip install -r requirements.txt
   ```

3. Создайте файл `.env`:

   ```ini
   TOKEN=y0_xDl5jKIf....   # OAuth-токен администратора Яндекс 360
   ORG_ID=8456...            # ID вашей организации
   # (опционально) глобальное значение уведомлений: all | delegates | none
   NOTIFY=none
   ```

---

## Формат `actors.csv`

Каждая строка = один сотрудник.
Формат:

```csv
actorId,role[,role2,...[,notify]]
```

### Примеры

Без `notify` (используется глобальный дефолт):

```csv
1130787397493,shared_mailbox_reader,shared_mailbox_sender 
8493894839893,shared_mailbox_owner 
```

С индивидуальным `notify` (переопределяет глобальный дефолт):

```csv
1130787397493,shared_mailbox_reader,shared_mailbox_sender,delegates 
8493894839893,shared_mailbox_owner,none 
```

* `actorId` — UID сотрудника в Яндекс 360.
* `role` — одна или несколько ролей.
* `notify` — кому отправить уведомление:

  * `all` — владельцу и сотруднику,
  * `delegates` — только сотруднику,
  * `none` — никому.

---

## Запуск

```bash
python create_shared_mailbox.py
```

Скрипт запросит у вас:

* `email` общего ящика,
* `name` общего ящика,
* `description` общего ящика.

Затем:

1. Создаст общий ящик в Яндекс 360.
2. Прочитает `actors.csv`.
3. Назначит роли и уведомления для каждого сотрудника.

---

## Результат

* В консоли будет видно лог по каждому пользователю:

  ```
  ✓ 1130787397493 -> roles=[shared_mailbox_sender] notify=delegates
  ✗ 8493894839893 -> ошибка назначения ...
  ```
* В конце вы получите статистику:

  ```
  Успешно: 5, ошибок: 1
  Проверьте готовность в панели администратора организации (Почта → Общие ящики и доступы).
  ```

---

## Примечания

* Для корректной работы у администратора должен быть OAuth-токен с правами на управление почтой.
* Роль `shared_mailbox_owner` включает все остальные, дублировать их не требуется.
* Если среди ролей нет ни `shared_mailbox_sender`, ни `shared_mailbox_owner`, скрипт добавит `shared_mailbox_sender` автоматически.

---

## Пример структуры репозитория

```
.
├── create_shared_mailbox.py   # основной скрипт
├── requirements.txt           # зависимости
├── .env.example               # пример .env
├── actors.csv.example         # пример actors.csv
└── README.md                  # документация
```

---

## Лицензия

MIT — используйте свободно, дорабатывайте под свои нужды.




